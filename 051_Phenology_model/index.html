
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Prof P. Lewis">
      
      <link rel="shortcut icon" href="../images/ucl.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Phenology Model - GEOG0111</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#051-a-phenology-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="GEOG0111" class="md-header-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            GEOG0111
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Phenology Model
            
          </span>
        </div>
      
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/UCL-EO/geog0111/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GEOG0111" class="md-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    GEOG0111
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/UCL-EO/geog0111/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Course Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Course Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Course Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use/" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix/" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help/" class="md-nav__link">
      Help
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../004_Accounts/" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../005_Packages/" class="md-nav__link">
      Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use_answers/" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix_answers/" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help_answers/" class="md-nav__link">
      Help
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Core Concepts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Core Concepts" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Core Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../010_Python_Introduction/" class="md-nav__link">
      Python Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../011_Python_data_types/" class="md-nav__link">
      Python Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../012_Python_strings/" class="md-nav__link">
      Python Strings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../013_Python_string_methods/" class="md-nav__link">
      Python String Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../014_Python_groups/" class="md-nav__link">
      Python Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../015_Python_control/" class="md-nav__link">
      Python Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../016_Python_for/" class="md-nav__link">
      Python For
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../017_Functions/" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../018_Running_Python/" class="md-nav__link">
      Running Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-10" type="checkbox" id="nav-3-10">
    
    <label class="md-nav__link" for="nav-3-10">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-3-10">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../010_Python_Introduction_answers/" class="md-nav__link">
      Python Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../011_Python_data_types_answers/" class="md-nav__link">
      Python Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../012_Python_strings_answers/" class="md-nav__link">
      Python Strings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../013_Python_string_methods_answers/" class="md-nav__link">
      Python String Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../014_Python_groups_answers/" class="md-nav__link">
      Python Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../015_Python_control_answers/" class="md-nav__link">
      Python Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../016_Python_for_answers/" class="md-nav__link">
      Python For
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../017_Functions_answers/" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../018_Running_Python_answers/" class="md-nav__link">
      Running Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Data Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Data Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Data Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../020_Python_files/" class="md-nav__link">
      Python Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../021_Streams/" class="md-nav__link">
      Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../022_Read_write_files/" class="md-nav__link">
      Read Write Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../023_Plotting/" class="md-nav__link">
      Plotting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../024_Image_display/" class="md-nav__link">
      Image Display
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../020_Python_files_answers/" class="md-nav__link">
      Python Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../021_Streams_answers/" class="md-nav__link">
      Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../022_Read_write_files_answers/" class="md-nav__link">
      Read Write Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../023_Plotting_answers/" class="md-nav__link">
      Plotting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../024_Image_display_answers/" class="md-nav__link">
      Image Display
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Array Data
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Array Data" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Array Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../030_NASA_MODIS_Earthdata/" class="md-nav__link">
      NASA MODIS Earthdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../031_Numpy/" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../032_More_numpy/" class="md-nav__link">
      More Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../030_NASA_MODIS_Earthdata_answers/" class="md-nav__link">
      NASA MODIS Earthdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../031_Numpy_answers/" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../032_More_numpy_answers/" class="md-nav__link">
      More Numpy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Geospatial Data
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Geospatial Data" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Geospatial Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../040_GDAL_mosaicing_and_masking/" class="md-nav__link">
      GDAL Mosaicing And Masking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../041_GDAL_timeseries/" class="md-nav__link">
      GDAL Timeseries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../042_Weighted_smoothing_and_interpolation/" class="md-nav__link">
      Weighted Smoothing And Interpolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../043_Weighted_interpolation/" class="md-nav__link">
      Weighted Interpolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../040_GDAL_mosaicing_and_masking_answers/" class="md-nav__link">
      GDAL Mosaicing And Masking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../041_GDAL_timeseries_answers/" class="md-nav__link">
      GDAL Timeseries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../043_Weighted_interpolation_answers/" class="md-nav__link">
      Weighted Interpolation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Modelling
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Modelling" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../050_Models/" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Phenology Model
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Phenology Model
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../050_Models_answers/" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../051_Phenology_model_answers/" class="md-nav__link">
      Phenology Model
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Assessment
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Assessment" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Assessment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../060_Groups/" class="md-nav__link">
      Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../061_Script/" class="md-nav__link">
      Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../062_Part1/" class="md-nav__link">
      Part1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../063_Part1_code/" class="md-nav__link">
      Part1 Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../064_Numpy/" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../065_LAI/" class="md-nav__link">
      Lai
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../066_Part2/" class="md-nav__link">
      Part2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-8" type="checkbox" id="nav-8-8">
    
    <label class="md-nav__link" for="nav-8-8">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-8-8">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../060_Groups_answers/" class="md-nav__link">
      Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../061_Script_answers/" class="md-nav__link">
      Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../064_Numpy_answers/" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../065_LAI_answers/" class="md-nav__link">
      Lai
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Summary
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Summary" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        Summary
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../070_Summary/" class="md-nav__link">
      Summary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/051_Phenology_model.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="051-a-phenology-model">051 A Phenology model</h1>
<h2 id="introduction">Introduction</h2>
<p>In the Nothern Hemisphere, and for temperate latitudes, there is a clear seasonal cycle in vegetation, particularly visible in leaf area index (LAI). We have seen that we have access to global LAI data over the last 20-odd years from MODIS. One of the indicators of a changing climate is a change in the pattern of vegetation dynamics. A warmer climate typically means that vegetation appears earlier in the year. </p>
<p>We call a model that describes the phases of plant development over the year a phenology model. There are many types we could consider, some of the more useful of which are driven by environmental data such as temperature. In that way, we can try to explain how much of the variation we see can be explained by inter-annual temperature variations. A simpler 'descriptive' model that is often used is the "double logistic" curve. </p>
<p>Mathematically, the function predicts the e.g. LAI (or some vegetation index) as</p>
<p>$$
y = p_0 - p_1\cdot\left[\frac{1}{1+\exp\left(p_2\cdot(t-p_3)\right)} + \frac{1}{1+\exp\left(-p_4\cdot(t-p_5)\right)} - 1\right].
$$</p>
<p>If we inspect this form, we can see that $p_0$ and $p_1$ scale the vertical span of the function, whereas $p_3$ and $p_5$ are some sort of temporal shift, and the remaining parameters $p_2$ and $p_4$ control the slope of the two flanks. </p>
<p>Let's access some LAI data that we have used before, and also look at the regularised data:</p>
<pre><code class="python">from geog0111.get_lai_data import get_lai_data
from geog0111.regularise import regularise
import numpy as np

# load some data
tile    = ['h17v03','h18v03','h17v04','h18v04']
year    = 2019
fips    = &quot;LU&quot;

lai,std,doy =  get_lai_data(year,tile,fips)
std[std&lt;1] = 1
weight = np.zeros_like(std)
mask = (std &gt; 0)
weight[mask] = 1./(std[mask]**2)
weight[lai &gt; 10] = 0.

interpolated_lai = regularise(lai,weight,5.0)
</code></pre>

<pre><code class="python">import matplotlib.pyplot as plt

p0,p1 = (107,72)
x_size,y_size=(10,5)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,lai[:,p0,p1],'+',label='LAI')
axs.plot(x,interpolated_lai[:,p0,p1],'g',label='smoothed LAI')
axs.plot(x,weight[:,p0,p1],'+',label='weight')

axs.set_title(f'{p0} {p1}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
axs.legend(loc='best')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7f04897b83d0&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_5_1.png" /></p>
<p>We can build a function for the model, provide an initial estimate at the model parameters:</p>
<pre><code class="python">import numpy as np

def dbl_sigmoid_function(p, t):
    &quot;&quot;&quot;The double sigmoid function defined over t (where t is an array).
    Takes a vector of 6 parameters&quot;&quot;&quot;

    sigma1 = 1./(1+np.exp(p[2]*(t-p[3])))
    sigma2 = 1./(1+np.exp(-p[4]*(t-p[5])))
    y = p[0] - p[1]*(sigma1 + sigma2 - 1)
    return y

t = np.arange(1, 366)
p = np.array([0.5, 4, 0.07, 100, 0.07, 260])
y = dbl_sigmoid_function(p, t)
</code></pre>

<p>and plot the observations and model:</p>
<pre><code class="python">import matplotlib.pyplot as plt

p0,p1 = (107,72)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,lai[:,p0,p1],'+',label='LAI')
axs.plot(x,interpolated_lai[:,p0,p1],'g',label='smoothed LAI')
axs.plot(t,y,'r',label='model')
axs.plot(x,weight[:,p0,p1],'+',label='weight')

axs.set_title(f'{p0} {p1}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
axs.legend(loc='best')
print('Luxembourg')
</code></pre>

<pre><code>Luxembourg
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_9_1.png" /></p>
<p>We can see that even with a rough guess of the model parameters, we can produce a plot that is strikingly similar to the regularised result we saw in previous sessions. That result shows what might be interpreted as a double feature around the maximum LAI, but we have seen that spurious features of this sort can arise from the filtering process. We might consider the logistic model a better interpretation of the data then. The double-logistic model has the additional advantage that the parameters have a physical meaning that we can map from year to year and compare. The regularisation result is itself of course, the result of a model. The main difference then is that the regularisation result is from a non-parametric model, and the double-logistic  is a parametric model.</p>
<p>We have seen that there are 6 model parameters. In the previous session, we learned rapid methods of parameter estimation that could only work with low dimensional data. We need to consider how to simply this model then, if we are to apply LUT approaches.</p>
<p>One idea is to attempt to normalise the vertical axis of the model. If we suppose we know the maximum and minimum LAI, we can use these as estimates of $p_0$ and $p_1$. One route to this would be to use the regularised model output. Next, we might assume that the slope parameters $p_2$ and $p_4$ are equal, without too much loss of generalisation. As a further simplification, we might assume we know this parameter, and fix it, at a value of 0.07 say. We can later look at the impact of these assumptions, but they have allowed us to reduce the problem to a 2-D one that we can easily solve with a LUT.</p>
<p>The remaining parameters $p_3$ and $p_5$ the times at which the curve most rapidly increases or decreases. For a LUT, these can be better phrased as:</p>
<pre><code>       width  = p5 - p3
       centre = (p3 + p5)/2
</code></pre>
<p>so:</p>
<pre><code>       p5 =  centre + width/2
       p3 =  centre - width/2
</code></pre>
<p>We might bound the width at between 50 and 250 days, and the centre at by 100 to 300 days. We must take the definition of time as modulo 365 to allow the model to operate in the Southern Hemisphere.</p>
<p>A simplified model and dataset then is:</p>
<pre><code class="python">import matplotlib.pyplot as plt

param0 = np.min(interpolated_lai,axis=0)
param1 = np.max(interpolated_lai,axis=0) - param0

fig, axs = plt.subplots(1,2,figsize=(14,8))
axs=axs.flatten()
im = axs[0].imshow(param1,interpolation=&quot;nearest&quot;,\
                vmax=7,cmap=plt.cm.inferno_r)
axs[0].set_title('p1')
fig.colorbar(im, ax=axs[0])
im = axs[1].imshow(param0,interpolation=&quot;nearest&quot;,\
                vmax=7,cmap=plt.cm.inferno_r)
axs[1].set_title('p0')
fig.colorbar(im, ax=axs[1])
</code></pre>

<pre><code>&lt;matplotlib.colorbar.Colorbar at 0x7f047dd7ce10&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_13_1.png" /></p>
<pre><code class="python">import numpy as np

'''
Define an interface to the simplified function
which we feed with known values in p
but ones we will wish to solve for in sp
'''
def simple_dbl_sigmoid_function(sp,p, t):
    &quot;&quot;&quot;The double sigmoid function defined over t (where t is an array).
    p is vector of 6 parameters
    p2 is 2 parameters: width and centre&quot;&quot;&quot;
    width,centre = sp
    p[5] =  (centre + width/2)
    p[3] =  (centre - width/2)
    p[2] =  p[4] = 0.07
    return dbl_sigmoid_function(p,t)

# use np.newaxis to resolve shapes of t and parameters
t = np.arange(1, 366)[:,np.newaxis,np.newaxis]
sp = [200.,200.]
p = [param0[np.newaxis,:,:],param1[np.newaxis,:,:],0,0,0,0]
y = simple_dbl_sigmoid_function(sp,p,t)
</code></pre>

<pre><code class="python">import matplotlib.pyplot as plt

p0,p1 = (107,72)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,lai[:,p0,p1],'+',label='LAI')
axs.plot(x,interpolated_lai[:,p0,p1],'g',label='smoothed LAI')
axs.plot(t[:,0,0],y[:,p0,p1],'r',label='model')
axs.plot(x,weight[:,p0,p1],'+',label='weight')

axs.set_title(f'{p0} {p1}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
axs.legend(loc='best')
print('Luxembourg: Simplified model')
</code></pre>

<pre><code>Luxembourg: Simplified model
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_15_1.png" /></p>
<p>As discussed previously, since we are doing pixel-by-pixel processing, we can change the 2D spatial data into a 1D flattened array. </p>
<pre><code class="python">param0_ = param0.ravel()
param1_ = param1.ravel()
print(f'param1  shape:  {param1.shape}')
print(f'param1_ shape:  {param1_.shape}')
</code></pre>

<pre><code>param1  shape:  (175, 122)
param1_ shape:  (21350,)
</code></pre>
<pre><code class="python">print(f'lai shape:    {lai.shape}')
print(f'weight shape: {weight.shape}')
</code></pre>

<pre><code>lai shape:    (92, 175, 122)
weight shape: (92, 175, 122)
</code></pre>
<p>And the same for the observations and weight but using <code>reshape</code> following the method in <a href="../032_More_numpy/#Simplifying-shape:-flatten,-ravel,-reshape-and-unravel_index">032_More_numpy</a>:</p>
<pre><code class="python">newshape = (*lai.shape[:1],np.prod(np.array(lai.shape[1:])))
print(newshape)
# reshape 
lai_    = lai.reshape(newshape)
weight_ = weight.reshape(newshape)

print(f'shape of lai  : {lai.shape}')
print(f'shape of lai_ : {lai_.shape}')
</code></pre>

<pre><code>(92, 21350)
shape of lai  : (92, 175, 122)
shape of lai_ : (92, 21350)
</code></pre>
<p>As with the previous exercise, we need to reconcile the observations and modelling time grid. In this case all we need do is to use <code>doy</code> in place of <code>t</code>.</p>
<p>We will form axes:</p>
<pre><code>(time,image index)
</code></pre>
<pre><code class="python">sp = [200.,200.]

t = doy[:,np.newaxis]
p = [param0_[np.newaxis,:],param1_[np.newaxis,:],0,0,0,0]
print(f't    shape:  {t.shape}')
print(f'p[1] shape:  {p[1].shape}')

y = simple_dbl_sigmoid_function(sp,p,t)
print(f'y shape:  {y.shape}')
</code></pre>

<pre><code>t    shape:  (92, 1)
p[1] shape:  (1, 21350)
y shape:  (92, 21350)
</code></pre>
<pre><code class="python"># weighted error
err = (lai_ - y) * weight_
# mean over time
rmse = np.sqrt(np.mean(err*err,axis=0))
print(rmse.shape)


fig, axs = plt.subplots(1,1,figsize=(5,5))
im = axs.imshow(rmse.reshape(lai[0].shape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs.set_title(f'RMSE for parameters {sp}')
fig.colorbar(im, ax=axs)
</code></pre>

<pre><code>(21350,)





&lt;matplotlib.colorbar.Colorbar at 0x7f047c486810&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_23_2.png" /></p>
<p>Let's build a 2-D LUT as previously, and provide a flattened version. We have defined bounds above:</p>
<pre><code class="python"># Use mgrid as previously to define a 2D grid of parameters
sp0min,sp0max,sp0step = 100,250,10
sp1min,sp1max,sp1step = 100,300,10
sp0,sp1 = np.mgrid[sp0min:sp0max+sp0step:sp0step,\
                 sp1min:sp1max+sp1step:sp1step]
sp0_ = sp0.ravel()
sp1_ = sp1.ravel()

print(f'shape of sp0  : {sp0.shape}')
print(f'shape of sp0_ : {sp0_.shape}')
</code></pre>

<pre><code>shape of sp0  : (16, 21)
shape of sp0_ : (336,)
</code></pre>
<p>We re-process the LAI just to make sure we have it handy and re-shaped:</p>
<pre><code class="python">newshape = (*lai.shape[:1],np.prod(np.array(lai.shape[1:])))
print(newshape)
# reshape 
lai_    = lai.reshape(newshape)
weight_ = weight.reshape(newshape)

print(f'shape of lai  : {lai.shape}')
print(f'shape of lai_ : {lai_.shape}')
</code></pre>

<pre><code>(92, 21350)
shape of lai  : (92, 175, 122)
shape of lai_ : (92, 21350)
</code></pre>
<p>Assigning the dimensions now is a little more complex, but we can revert to using the original model. We have one dimension that is time, one space, and one parameter space using the flattened arrays:</p>
<pre><code class="python"># dimensions: [t,npix,nsamp]
# more complex for this case
sp0_ext    = sp0_[np.newaxis,np.newaxis,:]
sp1_ext    = sp1_[np.newaxis,np.newaxis,:]
lai_ext    = lai_[:,:,np.newaxis]
weight_ext = weight_[:,:,np.newaxis]
t_ext      = doy[:,np.newaxis,np.newaxis]
param0_ext = param0_[np.newaxis,:,np.newaxis]
param1_ext = param1_[np.newaxis,:,np.newaxis]
param2_ext = 0.07
param3_ext = sp1_ext - sp0_ext/2.
param4_ext = 0.07
param5_ext = sp1_ext + sp0_ext/2.

# print out to check they line up
print(f'sp0_ext:    {sp0_ext.shape}')
print(f'sp1_ext:    {sp1_ext.shape}')
print(f'param0_ext: {param0_ext.shape}')
print(f'param1_ext: {param1_ext.shape}')
print(f'lai_ext:    {lai_ext.shape}')
print(f'weight_ext: {weight_ext.shape}')
print(f't_ext:      {t_ext.shape}')
</code></pre>

<pre><code>sp0_ext:    (1, 1, 336)
sp1_ext:    (1, 1, 336)
param0_ext: (1, 21350, 1)
param1_ext: (1, 21350, 1)
lai_ext:    (92, 21350, 1)
weight_ext: (92, 21350, 1)
t_ext:      (92, 1, 1)
</code></pre>
<pre><code class="python">sp = [sp0_ext,sp1_ext]
p = [param0_ext,param1_ext,param2_ext,\
     param3_ext,param4_ext,param5_ext]

y = dbl_sigmoid_function(p,t_ext)
print(y.shape)
</code></pre>

<pre><code>(92, 21350, 336)
</code></pre>
<pre><code class="python">error_ext = (y - lai_ext)*weight_ext
error_ext = error_ext*error_ext
rmse = np.sqrt(np.mean(error_ext,axis=0))
print(rmse.shape)
</code></pre>

<pre><code>(21350, 336)
</code></pre>
<p>We now have a value of RMSE for each element on the parameter grid (axis 1), for each pixel in the dataset (axis 0). </p>
<p>We next want to know the minimum over the parameter set (<code>axis 1</code>):</p>
<pre><code class="python">minrmse = rmse.min(axis=1)
print(minrmse.shape)

fig, axs = plt.subplots(1,1,figsize=(5,5))
# reshape for plotting
im = axs.imshow(minrmse.reshape(lai[0].shape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs.set_title(f'Min RMSE')
fig.colorbar(im, ax=axs)
</code></pre>

<pre><code>(21350,)





&lt;matplotlib.colorbar.Colorbar at 0x7f047c365310&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_33_2.png" /></p>
<p>To find the parameters at the minimum value, simply follow the same approach as previously using <code>argmin</code>, but with one extra dimension. In this case, <code>rmse</code> has shape <code>(21350, 336)</code> so we apply the argmin over the parameter dimension (axis 1):</p>
<pre><code class="python"># use np.argmin to find the minimum over axis 1
imin = np.argmin(rmse,axis=1)
p0min,p1min = sp0_[imin],sp1_[imin]
print(f'1D index shape of minimum  : {imin.shape}')
print(f'parameter shape at minimum : {p0min.shape},{p1min.shape}')

width, centre = p0min,p1min
p3 = centre - width/2
p5 = centre + width/2
</code></pre>

<pre><code>1D index shape of minimum  : (21350,)
parameter shape at minimum : (21350,),(21350,)
</code></pre>
<pre><code class="python">import matplotlib.pyplot as plt

# reshape p0min,p1min before plotting

fig, axs = plt.subplots(2,2,figsize=(10,10))
axs = axs.flatten()
ishape = lai[0].shape

im = axs[0].imshow(param0.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[0].set_title(f'p0')
fig.colorbar(im, ax=axs[0])

im = axs[1].imshow(param1.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[1].set_title(f'p1')
fig.colorbar(im, ax=axs[1])

im = axs[2].imshow(p3.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[2].set_title(f'p3')
fig.colorbar(im, ax=axs[2])

im = axs[3].imshow(p5.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[3].set_title(f'p5')
fig.colorbar(im, ax=axs[3])
</code></pre>

<pre><code>&lt;matplotlib.colorbar.Colorbar at 0x7f047c1a2b10&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_36_1.png" /></p>
<pre><code class="python">import matplotlib.pyplot as plt

fig, axs = plt.subplots(1,2,figsize=(10,5))
axs = axs.flatten()

im = axs[0].imshow(width.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[0].set_title(f'width')
fig.colorbar(im, ax=axs[0])

im = axs[1].imshow(centre.reshape(ishape),interpolation=&quot;nearest&quot;,\
                cmap=plt.cm.inferno_r)
axs[1].set_title(f'centre')
fig.colorbar(im, ax=axs[1])
</code></pre>

<pre><code>&lt;matplotlib.colorbar.Colorbar at 0x7f0477f788d0&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_37_1.png" /></p>
<p>Now forward model:</p>
<pre><code class="python">param3_ext = p3[np.newaxis,:,np.newaxis]
param5_ext = p5[np.newaxis,:,np.newaxis]

p = [param0_ext,param1_ext,param2_ext,\
     param3_ext,param4_ext,param5_ext]

# reshape to original lai shape
y = dbl_sigmoid_function(p,t_ext).reshape(lai.shape)
</code></pre>

<p>And visualise our test pixel:</p>
<pre><code class="python"># visualise RMSE for this pixel
# shape is npixels,ngrid
# RMSE full grid is nx,ny, npx,npy
newshape = (*(lai.shape[1:]),*(sp0.shape))
print(f'rmse full shape: {newshape}')
rmse_grid = rmse.reshape(newshape)[p0,p1]
min_rmse = rmse_grid.min()

# use np.argmin to find the minimum
imin = np.argmin(rmse_grid)
ip0min,ip1min = np.unravel_index(imin,sp0.shape)

p0min,p1min = sp0.ravel()[imin],sp1.ravel()[imin]
print(f'1D index of minimum  : {imin}')
print(f'parameter at minimum : {p0min},{p1min}')
</code></pre>

<pre><code>rmse full shape: (175, 122, 16, 21)
1D index of minimum  : 136
parameter at minimum : 160,200
</code></pre>
<pre><code class="python">import matplotlib.pyplot as plt

p0,p1 = (107,72)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,lai[:,p0,p1],'+',label='LAI')
axs.plot(x,interpolated_lai[:,p0,p1],'g',label='smoothed LAI')
axs.plot(doy,y[:,p0,p1],'r',label='model')
axs.plot(x,weight[:,p0,p1],'+',label='weight')

axs.set_title(f'{p0} {p1}: parameters {p0min} {p1min}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
axs.legend(loc='best')
print('Luxembourg optimised')
</code></pre>

<pre><code>Luxembourg optimised
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_42_1.png" /></p>
<pre><code class="python">import matplotlib.pyplot as plt
# Plot the reshaped RMSE values returned from this as an image

# plot it
fig, axs = plt.subplots(1,1,figsize=(15,8))
im = axs.imshow(rmse_grid,interpolation=&quot;nearest&quot;,\
                vmax=5*min_rmse,cmap=plt.cm.inferno_r)
fig.colorbar(im, ax=axs)
axs.set_title(f'{p0} {p1}: parameters {p0min} {p1min}')
axs.set_xlabel('p0')
axs.set_ylabel('p1')
plt.plot([ip1min],[ip0min],'r+',label=&quot;minimum RMSE&quot;)
axs.legend(loc='best')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7f0477dfdf90&gt;
</code></pre>
<p><img alt="png" src="../051_Phenology_model_files/051_Phenology_model_43_1.png" /></p>
<p>Given the criteria we discussed in <a href="../050_Models/#Visualisation-of-RMSE">050_Models</a>, we can see this as quite a good stable solution: it is not close to the boundaries, and we can see the shape of the erro functiuon quite well. The error function is perhaps a little flat, but it has a good form.</p>
<h4 id="exercise-1">Exercise 1</h4>
<ul>
<li>
<p>From the code above, develop a function <code>solver</code> in a file <code>work/lut_solver.py</code> that takes the following inputs:</p>
<ul>
<li>lai, weight : datasets of shape (Nt,Nx,Ny) for observations and reliability</li>
<li>2D parameter grids for model parameters p3 and p5 with shape (Np0,Np1)</li>
<li>function slope parameters p2 and p4 for the double sigmoid: float</li>
<li>function vertical min and extent parameters p0 and p1 of shape (Nx,Ny)</li>
</ul>
</li>
</ul>
<p>and solves for the optimal weighted fit between LAI and modelled LAI using the parameters pi
  It should return:</p>
<pre><code>*  p : list of 6 parameter arrays solved for, so 6 of shape (Nx,Ny)
* RMSE : the RMSE
</code></pre>
<ul>
<li>Produce a plot of all 6 model parameters    </li>
<li>The code could be made more efficient by not processing invalid pixels. Develop and use a mask of valid pixels to implement this.</li>
</ul>
<p>Hint: You might usefully define some utility functions such as <code>get_lai</code> and <code>get_p0p1</code> to allow you to easily load the datasets you need top run. You might base these around <code>geog0111.get_lai_data</code> and <code>geog0111.regularise</code>.</p>
<h2 id="summary">Summary</h2>
<p>We have shown that, with an initial estimate of 4 of the 6 model parameters, we can use a quite sparse 2-D LUT to provide a mapping of phenolology parameters for a given year for a country the size of Luxembourg in very fast time. The approach could be refined, for instance by other pair-wise inversions to refine the solution, but the improvement in this would likely be quite small. This is evidenced by the low overall RMSE for most of the country (all pixels RMSE less than 1.2 in weighted LAI).</p>
<p>For geospatial model parameter estimation, rapid methods such as this are vital because of the very large dataset dimensions. </p>
<p>To achieve this LUT-based parameter estimation, we have had to make extensive use of the fast array-processing facilities of <code>numpy</code>. As with the previous section, this involved building parameter grids using <code>np.mgrid</code>, and careful matching of dataset dimensions with <code>np.newaxis</code>. We used <code>np.argmin</code> to find the LUT index with the minimum RMSE value, for each pixel in the scene. This was slightly complicated by needing to flatten the LUT dimensions use a 1-D index for the minimum RMSE, and involved use of <code>np.reshape</code> and <code>np.flatten</code>. </p>
<p>The programming task here is quite complex, but a very practical one. You will not need to anything quite this complex for formal coursework submission (i.e. to pass the course) but you should all be able to follow and understand the approach taken here, and re-implement it for any similar situation.</p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 8, 2020</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../050_Models/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Models
              </div>
            </div>
          </a>
        
        
          <a href="../050_Models_answers/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Models
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>