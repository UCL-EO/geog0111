
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Prof P. Lewis">
      
      
      <link rel="icon" href="../images/ucl.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>GDAL Mosaicing And Masking - GEOG0111</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#040-gdal-mosaicing-and-masking" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GEOG0111" class="md-header__button md-logo" aria-label="GEOG0111" data-md-component="logo">
      
  <img src="../images/ucl.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GEOG0111
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GDAL Mosaicing And Masking
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/UCL-EO/geog0111" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GEOG0111" class="md-nav__button md-logo" aria-label="GEOG0111" data-md-component="logo">
      
  <img src="../images/ucl.png" alt="logo">

    </a>
    GEOG0111
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/UCL-EO/geog0111" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Course Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Course Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Course Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../001_Notebook_use/" class="md-nav__link">
        Notebook Use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../002_Unix/" class="md-nav__link">
        Unix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../003_Help/" class="md-nav__link">
        Help
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../004_Accounts/" class="md-nav__link">
        Accounts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../005_Packages/" class="md-nav__link">
        Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../001_Notebook_use_answers/" class="md-nav__link">
        Notebook Use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../002_Unix_answers/" class="md-nav__link">
        Unix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../003_Help_answers/" class="md-nav__link">
        Help
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Core Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Core Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../010_Python_Introduction/" class="md-nav__link">
        Python Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../011_Python_data_types/" class="md-nav__link">
        Python Data Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../012_Python_strings/" class="md-nav__link">
        Python Strings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../013_Python_string_methods/" class="md-nav__link">
        Python String Methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../014_Python_groups/" class="md-nav__link">
        Python Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../015_Python_control/" class="md-nav__link">
        Python Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../016_Python_for/" class="md-nav__link">
        Python For
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../017_Functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../018_Running_Python/" class="md-nav__link">
        Running Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_10" type="checkbox" id="__nav_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_10">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../010_Python_Introduction_answers/" class="md-nav__link">
        Python Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../011_Python_data_types_answers/" class="md-nav__link">
        Python Data Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../012_Python_strings_answers/" class="md-nav__link">
        Python Strings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../013_Python_string_methods_answers/" class="md-nav__link">
        Python String Methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../014_Python_groups_answers/" class="md-nav__link">
        Python Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../015_Python_control_answers/" class="md-nav__link">
        Python Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../016_Python_for_answers/" class="md-nav__link">
        Python For
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../017_Functions_answers/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../018_Running_Python_answers/" class="md-nav__link">
        Running Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Data Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Data Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Python_files/" class="md-nav__link">
        Python Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../021_URLs/" class="md-nav__link">
        Urls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../022_Pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../023_Plotting/" class="md-nav__link">
        Plotting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../024_Image_display/" class="md-nav__link">
        Image Display
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_6">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Python_files_answers/" class="md-nav__link">
        Python Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../021_URLs_answers/" class="md-nav__link">
        Urls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../022_Pandas_answers/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../023_Plotting_answers/" class="md-nav__link">
        Plotting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../024_Image_display_answers/" class="md-nav__link">
        Image Display
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Array Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Array Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Array Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../030_NASA_MODIS_Earthdata/" class="md-nav__link">
        NASA MODIS Earthdata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../031_Numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../032_More_numpy/" class="md-nav__link">
        More Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../030_NASA_MODIS_Earthdata_answers/" class="md-nav__link">
        NASA MODIS Earthdata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../031_Numpy_answers/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../032_More_numpy_answers/" class="md-nav__link">
        More Numpy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Geospatial Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Geospatial Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Geospatial Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GDAL Mosaicing And Masking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GDAL Mosaicing And Masking
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modis-dataset-access" class="md-nav__link">
    MODIS dataset access
  </a>
  
    <nav class="md-nav" aria-label="MODIS dataset access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tile-stitching-with-gdalbuildvrt" class="md-nav__link">
    Tile stitching with gdal.BuildVRT
  </a>
  
    <nav class="md-nav" aria-label="Tile stitching with gdal.BuildVRT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sub-setting" class="md-nav__link">
    Sub-setting
  </a>
  
    <nav class="md-nav" aria-label="Sub-setting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    Exercise 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-by-vector-dataset-with-gdalwarp" class="md-nav__link">
    Filtering by vector dataset with gdal.Warp
  </a>
  
    <nav class="md-nav" aria-label="Filtering by vector dataset with gdal.Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-4" class="md-nav__link">
    Exercise 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmodis" class="md-nav__link">
    getModis
  </a>
  
    <nav class="md-nav" aria-label="getModis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-5" class="md-nav__link">
    Exercise 5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdalbuildvrt-example" class="md-nav__link">
    gdal.BuildVRT() example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../041_GDAL_timeseries/" class="md-nav__link">
        GDAL Timeseries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../042_Weighted_smoothing_and_interpolation/" class="md-nav__link">
        Weighted Smoothing And Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../043_Weighted_interpolation/" class="md-nav__link">
        Weighted Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_5">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../040_GDAL_mosaicing_and_masking_answers/" class="md-nav__link">
        GDAL Mosaicing And Masking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../041_GDAL_timeseries_answers/" class="md-nav__link">
        GDAL Timeseries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../043_Weighted_interpolation_answers/" class="md-nav__link">
        Weighted Interpolation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Modelling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelling" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Modelling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../050_Models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../051_Phenology_model/" class="md-nav__link">
        Phenology Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../050_Models_answers/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../051_Phenology_model_answers/" class="md-nav__link">
        Phenology Model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Assessment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Assessment" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Assessment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../060_Groups/" class="md-nav__link">
        Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../061_Script/" class="md-nav__link">
        Script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../062_Part1/" class="md-nav__link">
        Part1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../063_Part1_code/" class="md-nav__link">
        Part1 Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../064_Numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../065_LAI/" class="md-nav__link">
        Lai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../066_Part2/" class="md-nav__link">
        Part2
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_8" type="checkbox" id="__nav_8_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_8">
          Answers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Answers" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_8">
          <span class="md-nav__icon md-icon"></span>
          Answers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../060_Groups_answers/" class="md-nav__link">
        Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../061_Script_answers/" class="md-nav__link">
        Script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../064_Numpy_answers/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../065_LAI_answers/" class="md-nav__link">
        Lai
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Summary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Summary" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Summary
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../070_Summary/" class="md-nav__link">
        Summary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modis-dataset-access" class="md-nav__link">
    MODIS dataset access
  </a>
  
    <nav class="md-nav" aria-label="MODIS dataset access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tile-stitching-with-gdalbuildvrt" class="md-nav__link">
    Tile stitching with gdal.BuildVRT
  </a>
  
    <nav class="md-nav" aria-label="Tile stitching with gdal.BuildVRT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sub-setting" class="md-nav__link">
    Sub-setting
  </a>
  
    <nav class="md-nav" aria-label="Sub-setting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    Exercise 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-by-vector-dataset-with-gdalwarp" class="md-nav__link">
    Filtering by vector dataset with gdal.Warp
  </a>
  
    <nav class="md-nav" aria-label="Filtering by vector dataset with gdal.Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-4" class="md-nav__link">
    Exercise 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmodis" class="md-nav__link">
    getModis
  </a>
  
    <nav class="md-nav" aria-label="getModis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-5" class="md-nav__link">
    Exercise 5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdalbuildvrt-example" class="md-nav__link">
    gdal.BuildVRT() example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/040_GDAL_mosaicing_and_masking.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="040-gdal-mosaicing-and-masking">040 GDAL: mosaicing and masking</h1>
<h3 id="purpose">Purpose</h3>
<p>In this section, we'll look at combining both raster and vector data to provide a masked dataset ready to use. We will produce a combined dataset of leaf area index (LAI) over the UK derived from the MODIS sensor that we have examined before.</p>
<p>At the end of this session, you should be able to use one or more of these methods to obtain a numpy array with a MODIS datatset for a particular place and time.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>You will need some understanding of the following:</p>
<ul>
<li><a href="../001_Notebook_use/">001 Using Notebooks</a></li>
<li><a href="../010_Python_Introduction/">010 Variables, comments and print()</a></li>
<li><a href="../011_Python_data_types/">011 Data types</a> </li>
<li><a href="../012_Python_strings/">012 String formatting</a></li>
<li><a href="../013_Python_string_methods/">013_Python_string_methods</a></li>
<li><a href="../020_Python_files/">020_Python_files</a></li>
<li><a href="../021_URLs/">021 URLs</a></li>
<li><a href="../022_Pandas/">022 Pandas</a></li>
<li><a href="../023_Plotting/">023 Plotting</a></li>
<li><a href="../024_Image_display/">024 Image display</a></li>
<li><a href="../030_NASA_MODIS_Earthdata/">030 NASA MODIS Earthdata</a></li>
<li><a href="../031_Numpy/">031 Numpy</a></li>
<li><a href="../032_More_numpy/">032 More numpy</a></li>
</ul>
<p>You will need to remember:</p>
<ul>
<li><a href="../030_NASA_MODIS_Earthdata/">the SDS in MODIS datasets</a></li>
<li>how to do <a href="../032_More_numpy/#slicing"><code>numpy</code> slicing</a> and numpy functions to get <a href="../031_Numpy/#Summary-statistics">array statistics</a></li>
</ul>
<h3 id="test">Test</h3>
<p>You should run a <a href="../004_Accounts/">NASA account test</a> if you have not already done so.</p>
<h2 id="modis-dataset-access">MODIS dataset access</h2>
<p>You should by now be able to access MODIS data, through the various routines in <a href="../geog0111/modisUtils.py"><code>modisUtils.py</code></a> we have used in <a href="../024_Image_display/#MODIS">024 Image display</a>
 and <a href="../030_NASA_MODIS_Earthdata/">030 NASA MODIS Earthdata</a>.</p>
<p>If we want more complex access, we can use <code>getModisFiles</code> to return a dictionary of multiple days, tiles, and SDS. We can use this information as the basis for creating tiles datasets in <code>gdal</code>.</p>
<pre><code class="language-python">from geog0111.modisUtils import getModisFiles

kwargs = {
    'product'    : 'MCD15A3H',
    'tile'       : ['h17v03','h18v03'],
    'year'       : 2019,
    'doys'       : [41],
    'sds'        : ['Lai_500m']
}

data_MCD15A3H = getModisFiles(verbose=False,timeout=1000,**kwargs)
data_MCD15A3H
</code></pre>
<pre><code>{'Lai_500m': {41: {'h17v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v03.006.2019050221756.hdf":MOD_Grid_MCD15A3H:Lai_500m',
   'h18v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h18v03.006.2019050221757.hdf":MOD_Grid_MCD15A3H:Lai_500m'}}}
</code></pre>
<p>An example of the full dataset name is:</p>
<pre><code class="language-python">print(data_MCD15A3H['Lai_500m'][41]['h17v03'])
</code></pre>
<pre><code>HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v03.006.2019050221756.hdf":MOD_Grid_MCD15A3H:Lai_500m
</code></pre>
<p>Armed with the SDS description, we can read a dataset from the MODIS file using <code>g.ReadAsArray()</code> after we have opened it. It returns a numpy array. We introduce <code>np.unique</code> that returns the unique values in a numpy array:</p>
<pre><code class="language-python">from osgeo import gdal
import numpy as np

this_sds = data_MCD15A3H['Lai_500m'][41]['h17v03']
# open the SDS of dataset 0
g = gdal.Open(this_sds)
data = g.ReadAsArray()
del g
print(type(data))
print('max:',data.max())
print('max:',data.min())
# get unique values, for interest
print('unique values:',np.unique(data))
</code></pre>
<pre><code>&lt;class 'numpy.ndarray'&gt;
max: 255
max: 0
unique values: [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35
  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53
  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70 250
 253 254 255]
</code></pre>
<h4 id="exercise-1">Exercise 1</h4>
<p>Recall that the MODIS LAI data need a scaling factor of 0.1 applied, and that values of greater than 100 are invalid.</p>
<p>For the dataset described by:</p>
<pre><code>kwargs = {
    'product'    : 'MCD15A3H',
    'tile'       : ['h17v03','h18v03'],
    'year'       : 2019,
    'doys'       : [41],
    'sds'        : ['Lai_500m']
}
</code></pre>
<ul>
<li>Use <code>gdal</code> to read the data into a <code>numpy</code> array called lai</li>
<li>print the shape of the array <code>lai</code></li>
<li>Find the maximum valid LAI value in the dataset</li>
<li>find at least one pixel (row, column) which has that maximum value.</li>
</ul>
<p>You will need to recall how to filter and <a href="../032_More_numpy/#argmin,-argmax-and-masking">mask <code>numpy</code> arrays</a> and use <a href="../032_More_numpy/#where"><code>np.where</code></a>.</p>
<h2 id="tile-stitching-with-gdalbuildvrt">Tile stitching with <code>gdal.BuildVRT</code></h2>
<p>Each MODIS tile has (SDS) datasets that are typically 1200x1200 pixels (1 km resolution) or 2400x2400 pixels (500 m resolution). Whilst we have to consider the MODIS tiles when downloading a dataset, after that point, we will probably want to work with data over some area that may only be a portion of a tile, or that may involve multiple tiles.</p>
<p>One approach to this is to read the individual tile data as above, the sub-set or stitch together multiple tiles. This is perfectly possible using <code>numpy</code> (see <a href="https://numpy.org/doc/stable/reference/generated/numpy.vstack.html"><code>np.vstack</code></a> and <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html"><code>np.hstack</code></a> to follow that up), but not generally very convenient. </p>
<p>Another factor is that, whilst the datasets are on regular grids, each location in the grid covers a unique geographical area. Once we load the data into a <code>numpy</code> array, we are no longer using the coordinate information available in the original geospatial dataset.</p>
<p>A final factor can be that it might be memory-inefficient to process data by reading it all into a large array.</p>
<p>Instead then, we can use <code>gdal</code> to stitch together geospatial data. A convenient way of doing this is to form a new <code>gdal</code> <a href="https://www.gdal.org/gdal_vrttut.html">virtual file</a>, using gdal.BuildVRT (check the documentation). </p>
<p>This function takes two inputs: the output filename (in the variable <code>ofile</code>) and a set of GDAL format filenames. </p>
<p>Let;'s first generate the dataset of filenames:</p>
<pre><code class="language-python">from osgeo import gdal
from geog0111.modisUtils import getModisFiles

kwargs = {
    'product'    : 'MCD15A3H',
    'tile'       : ['h17v03','h18v03','h17v04','h18v04'],
    'year'       : 2019,
    'doys'       : [41],
    'sds'        : ['Lai_500m']
}

data_MCD15A3H = getModisFiles(verbose=False,timeout=5000,**kwargs)
data_MCD15A3H
</code></pre>
<pre><code>{'Lai_500m': {41: {'h17v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v03.006.2019050221756.hdf":MOD_Grid_MCD15A3H:Lai_500m',
   'h18v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h18v03.006.2019050221757.hdf":MOD_Grid_MCD15A3H:Lai_500m',
   'h17v04': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v04.006.2019050222228.hdf":MOD_Grid_MCD15A3H:Lai_500m',
   'h18v04': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h18v04.006.2019050220136.hdf":MOD_Grid_MCD15A3H:Lai_500m'}}}
</code></pre>
<p>This returns a hierarchy of dictionaries.</p>
<p>The top level is the sds (<code>Lai_500m</code> here). Then <code>doy</code> (<code>41</code> here). </p>
<p>At the bottom level we have:</p>
<pre><code class="language-python">doy_v = data_MCD15A3H['Lai_500m'][41]
doy_v
</code></pre>
<pre><code>{'h17v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v03.006.2019050221756.hdf":MOD_Grid_MCD15A3H:Lai_500m',
 'h18v03': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h18v03.006.2019050221757.hdf":MOD_Grid_MCD15A3H:Lai_500m',
 'h17v04': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h17v04.006.2019050222228.hdf":MOD_Grid_MCD15A3H:Lai_500m',
 'h18v04': 'HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.02.10/MCD15A3H.A2019041.h18v04.006.2019050220136.hdf":MOD_Grid_MCD15A3H:Lai_500m'}
</code></pre>
<p>which has keys <code>h17v03</code>, <code>h18v03</code>, <code>h17v04</code> and <code>h18v04</code>, and values giving the SDS dataset full names.</p>
<p>We can usefully form a compound string of the tiles to use in a filename:</p>
<pre><code class="language-python">tiles = doy_v.keys()
'Tiles_'+'_'.join(tiles)
</code></pre>
<pre><code>'Tiles_h17v03_h18v03_h17v04_h18v04'
</code></pre>
<p>Let's loop around now and go over each level of the dictionary to form the filenames:</p>
<pre><code class="language-python">for sds,sds_v in data_MCD15A3H.items():
    print('sds',sds)
    for doy,doy_v in sds_v.items():
        print('doy',doy)
        # build a VRT 
        tiles = doy_v.keys()

        ofile = f&quot;work/stitch_{sds}_{kwargs['year']}_{doy:03d}_{'Tiles_'+'_'.join(tiles)}.vrt&quot;
        print(f'saving to {ofile}')      
</code></pre>
<pre><code>sds Lai_500m
doy 41
saving to work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt
</code></pre>
<p>Now let's call the <code>gdal.BuildVRT()</code> function information:</p>
<pre><code class="language-python">for sds,sds_v in data_MCD15A3H.items():
    print('sds',sds)
    for doy,doy_v in sds_v.items():
        print('doy',doy)
        # build a VRT 
        tiles = doy_v.keys()

        ofile = f&quot;work/stitch_{sds}_{kwargs['year']}_{doy:03d}_{'Tiles_'+'_'.join(tiles)}.vrt&quot;
        print(f'saving to {ofile}')    
        stitch_vrt = gdal.BuildVRT(ofile, list(doy_v.values()))
        del stitch_vrt
</code></pre>
<pre><code>sds Lai_500m
doy 41
saving to work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt
</code></pre>
<p>The <code>del</code> command in the loop forces the VRT files to be closed.</p>
<p>We can check what it looks like with e.g. <code>gdal.Info</code>.</p>
<pre><code class="language-python">ofile = 'work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt'
stitch_vrt = gdal.Open(ofile)
print(gdal.Info(stitch_vrt))
</code></pre>
<pre><code>Driver: VRT/Virtual Raster
Files: work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt
Size is 4800, 4800
Coordinate System is:
PROJCRS["unnamed",
    BASEGEOGCRS["Unknown datum based upon the custom spheroid",
        DATUM["Not specified (based on custom spheroid)",
            ELLIPSOID["Custom spheroid",6371007.181,0,
                LENGTHUNIT["metre",1,
                    ID["EPSG",9001]]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433,
                ID["EPSG",9122]]]],
    CONVERSION["unnamed",
        METHOD["Sinusoidal"],
        PARAMETER["Longitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["False easting",0,
            LENGTHUNIT["Meter",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["Meter",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["Meter",1]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["Meter",1]]]
Data axis to CRS axis mapping: 1,2
Origin = (-1111950.519667000044137,6671703.117999999783933)
Pixel Size = (463.312716527916677,-463.312716527708290)
Corner Coordinates:
Upper Left  (-1111950.520, 6671703.118) ( 20d 0' 0.00"W, 60d 0' 0.00"N)
Lower Left  (-1111950.520, 4447802.079) ( 13d 3'14.66"W, 40d 0' 0.00"N)
Upper Right ( 1111950.520, 6671703.118) ( 20d 0' 0.00"E, 60d 0' 0.00"N)
Lower Right ( 1111950.520, 4447802.079) ( 13d 3'14.66"E, 40d 0' 0.00"N)
Center      (       0.000, 5559752.598) (  0d 0' 0.01"E, 50d 0' 0.00"N)
Band 1 Block=128x128 Type=Byte, ColorInterp=Gray
  NoData Value=255
  Offset: 0,   Scale:0.1
</code></pre>
<p>So we see that we now have 4800 columns by 4800 rows dataset, centered around 0 degrees North, 0 degrees W. Let's plot the data.</p>
<pre><code class="language-python">import matplotlib.pyplot as plt

ofile = 'work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt'
stitch_vrt = gdal.Open(ofile)

fig, axs = plt.subplots(1,1,figsize=(12,6))
im = axs.imshow(stitch_vrt.ReadAsArray()*0.1,vmax=7,\
                cmap=plt.cm.inferno_r,interpolation='nearest')
fig.colorbar(im, ax=axs)

</code></pre>
<pre><code>&lt;matplotlib.colorbar.Colorbar at 0x7f0dc7e68610&gt;
</code></pre>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_23_1.png" /></p>
<h4 id="exercise-2">Exercise 2</h4>
<ul>
<li>
<p>write a function called <code>stitchModisDate</code> that you give the arguments:</p>
<ul>
<li>year</li>
<li>doy</li>
</ul>
</li>
</ul>
<p>and keywords/defaults:</p>
<pre><code>* sds='Lai_500m'
* tile=['h17v03','h18v03']
* product='MCD15A3H'
</code></pre>
<p>that then generates a stitched VRT file with the appropriate data, and returns the VRT filename. Make sure to use the <code>year</code> and <code>doy</code> in the VRT filename, along with the tiles, as in the examples above.</p>
<p>Try to design the code so that you could specify multiple doys.</p>
<h2 id="sub-setting">Sub-setting</h2>
<p>We have seen in <a href="../032_More_numpy/">032 More numpy</a> how we can use the idea of slicing to sub-set an array:</p>
<pre><code>array[start:stop:step]
</code></pre>
<p>The dataset we read in the previous section was 4800 x 4800 pixels. If we wanted to generate a sub-set for pixels in the Pyrenees for example, we could inspect the image above, and see that this would be covered by about:</p>
<pre><code>array[3900:4400,2000:3000]
</code></pre>
<p>We can use standard <a href="../032_More_numpy/#slicing"><code>numpy</code> slicing</a> to sub-set then:</p>
<pre><code class="language-python">xx = '1234.vrt'
xx[:-4]
</code></pre>
<pre><code>'1234'
</code></pre>
<pre><code class="language-python">ofile = 'work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt'
stitch_vrt = gdal.Open(ofile)
# get the lai data
lai = stitch_vrt.ReadAsArray()*0.1
# now subset
r0,r1 = 3900,4400
c0,c1 = 2000,3000
pyrenees = lai[r0:r1,c0:c1]

fig, axs = plt.subplots(1,1,figsize=(15,4))
im = axs.imshow(pyrenees,vmax=7,\
                cmap=plt.cm.inferno_r,interpolation='nearest')
fig.colorbar(im, ax=axs)

print(f'shape was {lai.shape}')
print(f'shape now {pyrenees.shape}')
</code></pre>
<pre><code>shape was (4800, 4800)
shape now (500, 1000)
</code></pre>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_27_1.png" /></p>
<p>That is rather inefficient though, and it is preferable to do the slicing when we call <code>ReadAsArray()</code>. This has a similar form of syntax for sub-setting:</p>
<pre><code>gdal.ReadAsArray(col_offset, row_offset, col_size, row_size)
</code></pre>
<pre><code class="language-python">ofile = 'work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04.vrt'
stitch_vrt = gdal.Open(ofile)

# get the lai data as sub-set directly
r0,r1 = 3900,4400
c0,c1 = 2000,3000

pyrenees = stitch_vrt.ReadAsArray(c0,r0,c1-c0,r1-r0)*0.1

fig, axs = plt.subplots(1,1,figsize=(15,4))
im = axs.imshow(pyrenees,vmax=7,\
                cmap=plt.cm.inferno_r,interpolation='nearest')
fig.colorbar(im, ax=axs)

print(f'shape now {pyrenees.shape}')
</code></pre>
<pre><code>shape now (500, 1000)
</code></pre>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_29_1.png" /></p>
<h4 id="exercise-3">Exercise 3</h4>
<ul>
<li>For doy 41 2019, extract and plot LAI of the sub-region around London by defining the approximate pixel coordinates of the area</li>
</ul>
<h2 id="filtering-by-vector-dataset-with-gdalwarp">Filtering by vector dataset with <code>gdal.Warp</code></h2>
<p>We can apply spatial filtering from a vector dataset, e.g. in a shape file, using <a href="https://gdal.org/programs/gdalwarp.html"><code>gdal.Warp</code></a>. We will explore this by filtering MODIS LAI by country boundary data.</p>
<p>A number of vectors with countries and administrative subdivisions are available. The <a href="http://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip">TM_WORLD_BORDERS shapefile</a> is popular and in the public domain. You can see it, and have a look at the data <a href="https://koordinates.com/layer/7354-tm-world-borders-03/">here</a>. The security on the website means that we cannot directly download the file, so instead we use the version stored in the <code>data</code> directory [<code>data/TM_WORLD_BORDERS-0.3.zip</code>].</p>
<p>We can use the command line <a href="https://gdal.org/index.html"><code>gdal</code></a> tool [<code>ogrinfo</code></p>
<pre><code class="language-python">!ogrinfo data/TM_WORLD_BORDERS-0.3.shp -al -where FIPS=&quot;'LU'&quot;
</code></pre>
<pre><code>INFO: Open of `data/TM_WORLD_BORDERS-0.3.shp'
      using driver `ESRI Shapefile' successful.

Layer name: TM_WORLD_BORDERS-0.3
Metadata:
  DBF_DATE_LAST_UPDATE=2008-07-30
Geometry: Polygon
Feature Count: 1
Extent: (-180.000000, -90.000000) - (180.000000, 83.623596)
Layer SRS WKT:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
FIPS: String (2.0)
ISO2: String (2.0)
ISO3: String (3.0)
UN: Integer (3.0)
NAME: String (50.0)
AREA: Integer (7.0)
POP2005: Integer64 (10.0)
REGION: Integer (3.0)
SUBREGION: Integer (3.0)
LON: Real (8.3)
LAT: Real (7.3)
OGRFeature(TM_WORLD_BORDERS-0.3):135
  FIPS (String) = LU
  ISO2 (String) = LU
  ISO3 (String) = LUX
  UN (Integer) = 442
  NAME (String) = Luxembourg
  AREA (Integer) = 0
  POP2005 (Integer64) = 456613
  REGION (Integer) = 150
  SUBREGION (Integer) = 155
  LON (Real) = 6.088
  LAT (Real) = 49.771
  POLYGON ((6.026256 50.181252,6.02861 50.166107,6.031111 50.160828,6.033889 50.159164,6.12 50.131943,6.134414 50.127846,6.130278 50.121941,6.128055 50.116386,6.118333 50.090828,6.112778 50.058884,6.113333 50.055832,6.130555 50.013885,6.140555 49.993889,6.173055 49.952217,6.175278 49.949997,6.234166 49.897499,6.250278 49.884163,6.255278 49.880554,6.315938 49.855316,6.321111 49.848328,6.395555 49.817772,6.429722 49.808884,6.481944 49.811104,6.522222 49.811104,6.524444 49.808609,6.524722 49.80555,6.505835 49.706627,6.484722 49.696106,6.473055 49.693604,6.46611 49.691109,6.420833 49.665833,6.356486 49.525864,6.362778 49.489166,6.36217 49.459389,6.328333 49.469162,6.302777 49.476662,6.247318 49.505974,6.239721 49.507774,6.229722 49.508331,6.165277 49.504715,6.156111 49.503883,6.124166 49.489716,6.123055 49.487221,6.122499 49.480553,6.12 49.471664,6.118055 49.469719,6.094444 49.454163,6.090555 49.453049,5.981388 49.448326,5.977777 49.448608,5.855277 49.501106,5.838611 49.51416,5.811666 49.536385,5.809999 49.538887,5.80788 49.545044,5.834167 49.549164,5.837777 49.550278,5.863055 49.571663,5.900277 49.640549,5.899166 49.662773,5.87615 49.709885,5.869444 49.719719,5.790277 49.78083,5.764999 49.789993,5.750833 49.791107,5.748055 49.79277,5.746666 49.795273,5.734444 49.834999,5.747777 49.907494,5.770833 49.95166,5.774722 49.956108,5.777499 49.957771,5.791389 49.962494,5.834444 49.986938,5.883055 50.077217,5.883055 50.080551,5.886666 50.098885,5.889444 50.104164,5.891666 50.10611,5.969722 50.16861,5.976388 50.171387,6.013888 50.181389,6.021944 50.18222,6.026256 50.181252))
</code></pre>
<p>We will use the <a href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> to refer to countries within the dataset and the <code>gdal</code> function <code>gdal.Warp</code> to filter by this vector dataset. The syntax is:</p>
<pre><code>g = gdal.Warp("", "stitch_up.vrt",
         format = 'MEM',
         dstNodata=255,
         cropToCutline = True,
         cutlineDSName = 'data/TM_WORLD_BORDERS-0.3.shp', 
         cutlineWhere = "FIPS='UK'")
</code></pre>
<p>where:
* the first argument (<code>""</code> here) is the output filename
* the second argument (<code>"stitch_up.vrt"</code> here) is the input file
* <code>format = 'MEM'</code> means that the file is written to memory, rather than being stored in a file. 
* <code>dstNodata=255</code> means that any no data values will be set to 0. 
* <code>cropToCutline = True</code> forces the dataset to be cropped at the dataset boundary
* <code>cutlineDSName = 'data/TM_WORLD_BORDERS-0.3.shp'</code> specifies the vector boundary dataset
* <code>cutlineWhere = "FIPS='UK'"</code> provides the condition for sub-setting</p>
<p>We choose a value of 255 for <code>dstNodata</code> because we have seen that only values between 0 and 100 are valid for this dataset.</p>
<pre><code class="language-python">from osgeo import gdal
import matplotlib.pyplot as plt
from geog0111.modisUtils import getModisFiles,stitchModisDate

kwargs = {
    'product'    : 'MCD15A3H',
    'tile'       : ['h17v03','h18v03'],
    'year'       : 2019,
    'doy'        : 41,
    'sds'        : 'Lai_500m'
}


warp_args = {
    'dstNodata'     : 255,
    'format'        : 'MEM',
    'cropToCutline' : False,
    'cutlineWhere'  : &quot;FIPS='UK'&quot;,
    'cutlineDSName' : 'data/TM_WORLD_BORDERS-0.3.shp'
}

vrtFile = stitchModisDate(**kwargs)

# build a VRT 
stitch_vrt = gdal.BuildVRT(vrtFile, kwargs['sds'][0])
del stitch_vrt

# now warp it
g = gdal.Warp(&quot;&quot;, vrtFile,**warp_args)

fig, axs = plt.subplots(1,1,figsize=(12,6))
im = axs.imshow(g.ReadAsArray()*0.1,vmax=7,\
                cmap=plt.cm.inferno_r,interpolation='nearest')
fig.colorbar(im, ax=axs)

</code></pre>
<pre><code>&lt;matplotlib.colorbar.Colorbar at 0x7f10c57ebf50&gt;
</code></pre>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_34_1.png" /></p>
<p>If you want to save the resultant file, e.g. to geoTiff or VRT file, then you would use e.g.:</p>
<pre><code>warp_args['format']   = 'GTiff'
warp_args['options']  = ['COMPRESS=LZW']
# compressed
g = gdal.Warp("uk.tif", "stitch_up.tif",**warp_args)
# force a write to disk
g.FlushCache()
</code></pre>
<p>or</p>
<pre><code>warp_args['format'] = 'VRT'
g = gdal.Warp("uk.vrt", "stitch_up.vrt",**warp_args)
# force a write to disk
g.FlushCache()
</code></pre>
<h4 id="exercise-4">Exercise 4</h4>
<ul>
<li>Plot the LAI for Luxemburg (<code>"FIPS='LU'"</code>) for doy 46, 2019</li>
<li>find the mean LAI for Luxemburg for doy 46, 2019 to 2 d.p.</li>
</ul>
<h3 id="getmodis"><code>getModis</code></h3>
<p>For convenience, we can use the function <code>getModis</code> to combine these.</p>
<p>It returns a data file containing the tiled/warped data in a file (filename returned):</p>
<pre><code class="language-python">from geog0111.modisUtils import getModis

warp_args = {
    'dstNodata'     : 255,
    'format'        : 'MEM',
    'cropToCutline' : True,
    'cutlineWhere'  : &quot;FIPS='UK'&quot;,
    'cutlineDSName' : 'data/TM_WORLD_BORDERS-0.3.shp'
}

kwargs = {
    'tile'      :    ['h17v03','h18v03','h17v04','h18v04'],
    'product'   :    'MCD15A3H',
    'sds'       :    'Lai_500m',
    'doys'       : [9,41],
    'year'      : 2019,
    'warp_args' : warp_args
}

datafiles,bnames = getModis(verbose=False,**kwargs)

print(datafiles,bnames)
</code></pre>
<pre><code>['work/stitch_Lai_500m_2019_009_Tiles_h17v03_h18v03_h17v04_h18v04_Selektor_FIPS_UK_warp.vrt', 'work/stitch_Lai_500m_2019_041_Tiles_h17v03_h18v03_h17v04_h18v04_Selektor_FIPS_UK_warp.vrt'] ['2019-009', '2019-041']
</code></pre>
<pre><code class="language-python">from osgeo import gdal
import matplotlib.pyplot as plt

for datafile,bname in zip(datafiles,bnames):
    g = gdal.Open(datafile)
    fig, axs = plt.subplots(1,1,figsize=(12,6))
    im = axs.imshow(g.ReadAsArray()*0.1,vmax=7,\
                    cmap=plt.cm.inferno_r,interpolation='nearest')
    axs.set_title(bname)
    _=fig.colorbar(im, ax=axs)
</code></pre>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_39_0.png" /></p>
<p><img alt="png" src="../040_GDAL_mosaicing_and_masking_files/040_GDAL_mosaicing_and_masking_39_1.png" /></p>
<h4 id="exercise-5">Exercise 5</h4>
<ul>
<li>Use <code>getModis</code> to plot the LAI for France for doy 9, 41 and 49, 2019</li>
<li>find the median LAI for France for doy 9, 41 and 49, 2019 to 2 d.p.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>We have started to do some fuller geospatial processing now. We have seen how to use <code>gdal</code> for reading datasets, as well as mosaicing them and filtering by some vector dataset. We can take a subset of an image when we use <code>gdal.ReadAsArray()</code>. We have learned how to do these things using the MODIS HDF files and SDS descriptors.</p>
<p>We have also seen some utility functions to aid our use of these data. In particular, we can use <code>getModis</code> from <a href="../geog0111/modisUtils.py"><code>geog0111.modisUtils</code></a> as a simple interface to download and stitch MODIS data. It makes use of a cache to avoid having to re-download the datasets each time we want to use them.</p>
<table>
<thead>
<tr>
<th>function</th>
<th>comment</th>
<th>example and keywords</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>g = gdal.Open(filename)</code></td>
<td>Open geospatial file <code>filename</code> and return <code>gdal</code> object <code>g</code> (<code>None</code> if file not opened correctly)</td>
<td></td>
</tr>
<tr>
<td><code>g.GetSubDatasets()</code></td>
<td>Get list of sub-datasets from <code>gdal</code> object <code>g</code></td>
<td></td>
</tr>
<tr>
<td><code>g.ReadAsArray(c0,r0,nc,nr)</code></td>
<td>Read dataset from <code>gdal</code> object <code>g</code> into array. Form <code>c0</code> for <code>nc</code> columns and <code>r0</code> for <code>nr</code> rows. Set as <code>None</code> for defaults or don't give.</td>
<td></td>
</tr>
<tr>
<td><code>gdal.BuildVRT(ofile, sds)</code></td>
<td>create <code>gdal</code> VRT (wrapper) file called <code>ofile</code> for SDS/file <code>sds</code></td>
<td>see <a href="#gdal.BuildVRT()-example">below</a></td>
</tr>
<tr>
<td><code>gdal.Info(f)</code></td>
<td>Print information about geospatial file <code>f</code></td>
<td></td>
</tr>
<tr>
<td><code>gdal.Warp(ofile,ifile)</code></td>
<td>Warp <code>ifile</code> to <code>ofile</code> with keyword parameters</td>
<td>Keywords:</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>format = 'MEM'</code> or <code>format = 'GTiff'</code> : output format</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>options=['COMPRESS=LZW']</code> : compression option for GTiff etc.</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>dstNodata=255</code>: no data value</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>cropToCutline = True</code> : whether to crop to cutline or bounds</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>cutlineDSName = 'data/TM_WORLD_BORDERS-0.3.shp'</code> : vector dataset for cutline</td>
</tr>
<tr>
<td></td>
<td></td>
<td><code>cutlineWhere = "FIPS='UK'"</code> : identifier information for cutline</td>
</tr>
<tr>
<td><code>g.FlushCache()</code></td>
<td>flush open <code>gdal</code> object <code>g</code> (force write to file)</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="gdalbuildvrt-example"><code>gdal.BuildVRT() example</code></h3>
<pre><code class="language-python">from geog0111.modisUtils import getModisFiles
from osgeo import gdal
import numpy as np

kwargs = {
    'tile'      :    ['h17v03','h18v03','h17v04','h18v04'],
    'product'   :    'MCD15A3H',
    'sds'       :    'Lai_500m',
    'doys'       : [9],
    'year'      : 2019,
}
data = getModisFiles(**kwargs)
# data here is a hierarchical dict
# with data organised as:
#     data[sds][doy][tiles]
# giving the sds strings
for sds, sds_v in data.items():
    for doy, doy_v in sds_v.items():
        tiles = doy_v.keys()
        print(f'sds: {sds} doy: {doy} tiles: {tiles}')
        ofile = f&quot;work/stitch_{sds}_{kwargs['year']}_{doy:03d}_{'Tiles_'+'_'.join(tiles)}.vrt&quot;
        print(f'    -&gt; {ofile}')
        [print(f'    {i}') for i in doy_v.values()]
        stitch_vrt = gdal.BuildVRT(ofile, list(doy_v.values()))
        del stitch_vrt
</code></pre>
<pre><code>sds: Lai_500m doy: 9 tiles: dict_keys(['h17v03', 'h18v03', 'h17v04', 'h18v04'])
    -&gt; work/stitch_Lai_500m_2019_009_Tiles_h17v03_h18v03_h17v04_h18v04.vrt
    HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.01.09/MCD15A3H.A2019009.h17v03.006.2019016142318.hdf":MOD_Grid_MCD15A3H:Lai_500m
    HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.01.09/MCD15A3H.A2019009.h18v03.006.2019016142319.hdf":MOD_Grid_MCD15A3H:Lai_500m
    HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.01.09/MCD15A3H.A2019009.h17v04.006.2019016142314.hdf":MOD_Grid_MCD15A3H:Lai_500m
    HDF4_EOS:EOS_GRID:"/shared/groups/jrole001/geog0111/e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2019.01.09/MCD15A3H.A2019009.h18v04.006.2019016142318.hdf":MOD_Grid_MCD15A3H:Lai_500m
</code></pre>
<pre><code class="language-python">from geog0111.modisUtils import getModis

help(getModis)
</code></pre>
<pre><code>Help on function getModis in module geog0111.modisUtils:

getModis(year=2019, doys=[1], sds='Lai_500m', tile=['h17v03', 'h18v03'], format='VRT', verbose=False, timeout=None, product='MCD15A3H', warp_args={})
    function to return Modis data array for defined
    conditions, for a single day and single SDS and
    product.

    Arguments:
        year     : int - year (2019)
        doys     : list of int - day of year ([1])
        sds      : SDS we want to retrieve ('Lai_500m')
        tile     : list of tiles to process (['h17v03','h18v03'])
        product  : MODIS data product (MCD15A3H')
        warp_args: cropping or warping arguments ({})

        ofile    : output (GTiff) filename
        format   : 'VRT' or 'GTiff' ('VRT' default)

        verbose  : verbose (False)
        timeout  : timeout (None) in seconds. Set to e.g. 1000 if
                   you are having problems


    generates stitched VRT files for each doy with the appropriate data,
    save in VRT of GTiff, along with data you can use to identify the year and doy

    returns:

        VRT (or GTiff) filename, a list of strings of year-doy
</code></pre>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 6, 2021</span>
      
    
  </small>
</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../032_More_numpy_answers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: More Numpy" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              More Numpy
            </div>
          </div>
        </a>
      
      
        
        <a href="../041_GDAL_timeseries/" class="md-footer__link md-footer__link--next" aria-label="Next: GDAL Timeseries" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              GDAL Timeseries
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/prof_plewis" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://hub.docker.com/r/proflewis/geog0111" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/UCL-EO/geog0111" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
    
  </body>
</html>