<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Prof P. Lewis">
        <link rel="canonical" href="https://ucl-eo.github.io/geog0111/DEV_scripts/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Scripts - GEOG0111</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-1.10.2.min.js" defer></script>
    <script src="../js/bootstrap-3.3.7.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-1347772-1', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">GEOG0111</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Introduction</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Course Basics <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../001_Notebook_use/" class="dropdown-item">Notebook Use</a>
</li>
                                    
<li>
    <a href="../002_Unix/" class="dropdown-item">Unix</a>
</li>
                                    
<li>
    <a href="../003_Help/" class="dropdown-item">Help</a>
</li>
                                    
<li>
    <a href="../004_Accounts/" class="dropdown-item">Accounts</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../001_Notebook_use_answers/" class="dropdown-item">Notebook Use</a>
</li>
            
<li>
    <a href="../002_Unix_answers/" class="dropdown-item">Unix</a>
</li>
            
<li>
    <a href="../003_Help_answers/" class="dropdown-item">Help</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Core Concepts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../010_Python_Introduction/" class="dropdown-item">Python Introduction</a>
</li>
                                    
<li>
    <a href="../011_Python_data_types/" class="dropdown-item">Python Data Types</a>
</li>
                                    
<li>
    <a href="../012_Python_strings/" class="dropdown-item">Python Strings</a>
</li>
                                    
<li>
    <a href="../013_Python_string_methods/" class="dropdown-item">Python String Methods</a>
</li>
                                    
<li>
    <a href="../014_Python_groups/" class="dropdown-item">Python Groups</a>
</li>
                                    
<li>
    <a href="../015_Python_control/" class="dropdown-item">Python Control</a>
</li>
                                    
<li>
    <a href="../016_Python_for/" class="dropdown-item">Python For</a>
</li>
                                    
<li>
    <a href="../017_Functions/" class="dropdown-item">Functions</a>
</li>
                                    
<li>
    <a href="../018_Packages/" class="dropdown-item">Packages</a>
</li>
                                    
<li>
    <a href="../019_Running_Python/" class="dropdown-item">Running Python</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../010_Python_Introduction_answers/" class="dropdown-item">Python Introduction</a>
</li>
            
<li>
    <a href="../011_Python_data_types_answers/" class="dropdown-item">Python Data Types</a>
</li>
            
<li>
    <a href="../012_Python_strings_answers/" class="dropdown-item">Python Strings</a>
</li>
            
<li>
    <a href="../013_Python_string_methods_answers/" class="dropdown-item">Python String Methods</a>
</li>
            
<li>
    <a href="../014_Python_groups_answers/" class="dropdown-item">Python Groups</a>
</li>
            
<li>
    <a href="../015_Python_control_answers/" class="dropdown-item">Python Control</a>
</li>
            
<li>
    <a href="../016_Python_for_answers/" class="dropdown-item">Python For</a>
</li>
            
<li>
    <a href="../017_Functions_answers/" class="dropdown-item">Functions</a>
</li>
            
<li>
    <a href="../019_Running_Python_answers/" class="dropdown-item">Running Python</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Datasets <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../020_NASA_MODIS_Earthdata/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
                                    
<li>
    <a href="../020_Python_files/" class="dropdown-item">Python Files</a>
</li>
                                    
<li>
    <a href="../021_Read_files/" class="dropdown-item">Read Files</a>
</li>
                                    
<li>
    <a href="../022_NASA_MODIS_Earthdata/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
                                    
<li>
    <a href="../022_Pandas_and_plotting/" class="dropdown-item">Pandas And Plotting</a>
</li>
                                    
<li>
    <a href="../024_GoogleEarthEngine/" class="dropdown-item">Google Earth Engine</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_NASA_MODIS_Earthdata_answers/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
            
<li>
    <a href="../020_Python_files_answers/" class="dropdown-item">Python Files</a>
</li>
            
<li>
    <a href="../021_Read_files_answers/" class="dropdown-item">Read Files</a>
</li>
            
<li>
    <a href="../022_NASA_MODIS_Earthdata_answers/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Image Processing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../031_Numpy_matplotlib/" class="dropdown-item">Numpy Matplotlib</a>
</li>
                                    
<li>
    <a href="../031_Plotting/" class="dropdown-item">Plotting</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Geospatial Data <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../040_GDAL/" class="dropdown-item">GDAL</a>
</li>
                                    
<li>
    <a href="../041_MODIS_download/" class="dropdown-item">MODIS Download</a>
</li>
                                    
<li>
    <a href="../042_GDAL_masking/" class="dropdown-item">GDAL Masking</a>
</li>
                                    
<li>
    <a href="../043_GDAL_stacking_and_interpolating/" class="dropdown-item">GDAL Stacking And Interpolating</a>
</li>
                                    
<li>
    <a href="../044_GDAL_Reconciling_projections/" class="dropdown-item">GDAL Reconciling Projections</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Modelling <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../050_Linear_models/" class="dropdown-item">Linear Models</a>
</li>
                                    
<li>
    <a href="../051_Modelling_and_optimisation/" class="dropdown-item">Modelling And Optimisation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../DEV_Local_Install/" class="dropdown-item">Local Install</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Scripts</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../DEV_Local_Install/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/DEV_scripts.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#scripts" class="nav-link">Scripts</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#docker" class="nav-link">Docker</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#scripts_1" class="nav-link">Scripts</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="scripts">Scripts</h1>
<p>This note describes utility scripts in <a href="bin"><code>bin</code></a> and <a href="geog0111"><code>geog0111</code></a>.</p>
<h2 id="docker">Docker</h2>
<p>The Docker file is in <a href="copy/Dockerfile"><code>Docker/Dockerfile</code></a>. This is a minimal setup for running notebooks for this course, being based on <a href="https://hub.docker.com/r/jgomezdans/uclgeog"><code>jgomezdans/uclgeog</code></a> which is derived from <a href="https://github.com/jgomezdans/geog_docker"><code>geog_docker</code></a>. </p>
<p>This docker is stored on dockerhub as <a href="https://hub.docker.com/r/ucleo/geog0111"><code>ucleo/geog0111</code></a> and derived from this repo <a href="https://github.com/UCL-EO/geog0111"><code>UCL-EO/geog0111</code></a>.</p>
<p>It is automatically run from <a href="https://travis-ci.com/github/UCL-EO/geog0111">travis</a> on a new load, so you shouldn't need to generate the docker manually.</p>
<p>The docker cleans out the environment for <code>uclgeog</code>, as we want opne called <code>geog0111</code>, clones <a href="https://github.com/UCL-EO/geog0111">this repository</a> and runs <a href="../bin/setup.sh"><code>bin/setup.sh</code></a> to install the <code>geog0111</code> environment. It activates the environment and runs <a href="bin/postBuild"><code>bin/postBuild</code></a>. </p>
<h3 id="clean-up-docker-files">Clean up docker files</h3>
<p>The script <a href="bin/docker-killall"><code>bin/docker-killall</code></a> cleans up any cached dockers, kills running dockers, and cleans it all out. Use this only to make a clean slate for your docker in the repoi.
Otherwise, use more subtle <code>docker</code> commands. It is intended onbly for developers, but is run as user.</p>
<h3 id="build-docker">Build docker</h3>
<p>The script <a href="bin/docker-build"><code>bin/docker-build</code></a> will build and upload the docker. This is again intended just for developers, and requires a login to dockerhub.</p>
<h3 id="run-docker">Run docker</h3>
<p>The script <a href="bin/docker-run"><code>bin/docker-run</code></a> can be used to run the docker and launch a notebook. It will attempt to map the <code>work</code> directory to the current directory or <code>${HOME}/OneDrive*</code>. It will try to re-use an existing docker image.</p>
<p>Normal use then would be something like:</p>
<p>cd /Users/plewis/work
   ~/geog0111/bin/docker-run</p>
<p>The first time you use this, it will show something like:</p>
<pre><code>--&gt; running bin/docker-run from /Users/plewis/work
--&gt; mount /Users/plewis/work
--&gt; bin/docker-run: no existing docker image found
--&gt; bin/docker-run: running docker with /Users/plewis/work as /home/jovyan/notebooks/work
</code></pre>
<p>So anything we save into <code>/home/jovyan/notebooks/work</code> in the notebook will go into <code>/Users/plewis/work</code>.</p>
<p>The notebook will start with a message such as:</p>
<pre><code>Serving notebooks from local directory: /home/jovyan/geog0111/notebooks
1 active kernel
The Jupyter Notebook is running at:
http://8fbac34af2bc:8888/?token=42897db02a8f1168ae2d7fb37aa2acdfcba51d47560a96dc
 or http://127.0.0.1:8888/?token=42897db02a8f1168ae2d7fb37aa2acdfcba51d47560a96dc
</code></pre>
<p>and you can access the notebooks from this address in a browser.</p>
<p>To end the session, type <code>^C</code> (<code>CONTROL + c</code>) in the teminal you ran the command from.</p>
<p>If you now type:</p>
<pre><code>docker ps -l
</code></pre>
<p>You should see an existing image e.g.:</p>
<pre><code>docker ps -l 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES
8fbac34af2bc        ucleo/geog0111      "tini -g -- start-noâ€¦"   28 minutes ago      Exited (0) 2 minutes ago                       jolly_maxwell
</code></pre>
<p>If  you really want to delete that (start again with yoiur notebooks), you can with:</p>
<pre><code>docker container rm jolly_maxwell
</code></pre>
<p>but it should normally be fine to re-use.</p>
<p>The next time you run thiis command, it should recognise an existing docker image and respind with something like:</p>
<pre><code>--&gt; running bin/docker-run from /Users/plewis/work
--&gt; mount /Users/plewis/work
--&gt; bin/docker-run: using docker image jolly_maxwell
</code></pre>
<h2 id="scripts_1">Scripts</h2>
<h3 id="binsetupsh"><code>bin/setup.sh</code></h3>
<p><a href="../bin/setup.sh"><code>bin/setup.sh</code></a> is the core setup script. It is run for example from <a href="copy/Dockerfile"><code>Docker/Dockerfile</code></a>
but may also be run on the repository. It should usually be run by the user and should work from any operating system.</p>
<pre><code>setup.sh [-r | --remove] [-f|--force] | [-n|--no_force]
</code></pre>
<p>The main purpose of the script is to run the <code>conda</code> setup to make the conda environment <code>geog0111</code> from <a href="../copy/environment.yml">Docker/environment.yml</a>.
It will detect if windows is being used (so run <code>conda.bat</code>) and test to see if the environment <code>geog0111</code> already exists. If it does, it can be removed (<code>--remove</code>) or a foce install done (<code>--force</code>). Otherwise, it will try to update the environment from <a href="../copy/environment.yml">Docker/environment.yml</a>.</p>
<p>It generates a file <a href="copy/dockenvrc"><code>~/.dockenvrc</code></a> to be run on shell startup to activate the environment.</p>
<p>After running this script, you should manually activate the environment:</p>
<pre><code>conda activcate geog0111
</code></pre>
<h3 id="binpostbuild"><code>bin/postBuild</code></h3>
<p><a href="bin/postBuild"><code>bin/postBuild</code></a> is run after <a href="../bin/setup.sh"><code>bin/setup.sh</code></a> and does jobs such as setting up the jupyter notebook extensions, installing the <code>geog0111</code> package locally (using <a href="../copy/setup.py"><code>setup.py</code></a>) and ensuring shell initialisation is properly done for subsequent sessions. It should be run the the user, and woul;d normally be run after any new run of <a href="../bin/setup.sh"><code>bin/setup.sh</code></a>.</p>
<h3 id="binlink-setsh"><code>bin/link-set.sh</code></h3>
<p><a href="../bin/link-set.sh"><code>bin/link-set.sh</code></a> is the directory linking script. 
It should usually be run by the user.</p>
<p>Users may work in any of several directories, so we need to put in symbolic links
from common directories (<code>data</code> <code>$repo</code> <code>images</code>) in each of these to ensure
correct operation. This script does that: It goes into each of <code>notebooks</code> 
<code>notebooks/work</code> <code>docs</code> <code>notebooks_lab</code> <code>notebooks_lab/work</code> <code>docs/work</code> and puts a 
symbolic link to <code>data</code> <code>$repo</code> <code>images</code> in <code>..</code>. Since relative paths are used,
this is portable.</p>
<p>In addition, it puts a link in from <code>~/$repo</code> to <code>$repo</code> for convenience (unless this 
already exists). It also puts a link in from <code>$UCLDATA</code> to <code>data/ucl</code> (default <code>${HOME}/geog0111/work</code>)
so that a system-wide data directory can be put in, and referred to asd <code>data/ucl</code> from
scripts.</p>
<p>This is called <a href="../bin/setup.sh"><code>bin/setup.sh</code></a>, but may be run independently to fix any broken links.</p>
<h3 id="binnotebook-runsh"><code>bin/notebook-run.sh</code></h3>
<p>This script runs all notebooks in <a href="notebooks"><code>notebooks</code></a> using <code>jupyter nbconvert</code>. The files are saved as <code>*.nbconvert.md</code>. The running is tolerant to errors. If the file is no different to the original, the original is kept. Otherwise the user is prompted to see if you want to replace the original notebook with the one that has been executed. You are provided with information on file sizes, which should help with this decision: you might not want to save a notebook that is (much) smaller than the original. Backups are stored in <code>backup.$$</code> which you need to manually clear.</p>
<p>You might run this as a pre-cursor to <a href="../bin/notebook-mkdocs.sh"><code>bin/notebook-mkdocs.sh</code></a>.</p>
<h3 id="binnotebook-mkdocssh"><code>bin/notebook-mkdocs.sh</code></h3>
<p>This script <a href="../bin/notebook-mkdocs.sh"><code>bin/notebook-mkdocs.sh</code></a> filters notebooks in <a href="notebooks"><code>notebooks</code></a> into <a href="notebooks_lab"><code>notebooks_lab</code></a> using <a href="../geog0111/edit_notebook.py"><code>geog0111/edit_notebook.py</code></a>. This filters out noteboom extensions and other features, and makes the notebooks suitable for running in <a href="https://jupyterlab.readthedocs.io/en/stable/">JupyterLab</a>, rather than just <code>jupyter noteboook</code>. It strips out exercises defiuned in <code>exercise2</code> cells, into new notebooks with the pattern <code>_answers.md</code>.</p>
<p>The script takes the <a href="notebooks_lab"><code>notebooks_lab</code></a> notebooks, and converts to markdown in <a href="docs"><code>docs</code></a> and prepares the environment for the document generator <code>mkdocs</code> using <a href="../geog0111/mkdocs_prep.py"><code>geog0111/mkdocs_prep.py</code></a>. 
It runs <code>mkdocs build</code> locally. The documents can be viewed with:</p>
<pre><code>mkdocs serve
</code></pre>
<p>and/or uploaded to the document server (by the developer) using:</p>
<pre><code>mkdocs gh-deploy --force
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
